@(dataset: Dataset, things: Int, annotations: Int, places: Int, supersets: Seq[Dataset], subsets: Seq[Dataset])
<html>
  <head>
    <title>Dataset &raquo; @dataset.title</title>
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/datasets/dataset-details.css")"/>   
    <link rel="stylesheet" href="@routes.Assets.at("javascripts/lib/leaflet/leaflet.css")"/>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery-1.9.0.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery.simplePagination.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/leaflet/leaflet.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/leaflet/leaflet-heat.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/numeral.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/heatmap.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/temporal-profile.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/page-utils.js")"></script>
  </head>
  <body>
    <div id="header">
      <div id="header-menu">
        <div class="row">
          <a class="pelagios-logo" href="@controllers.pages.routes.HomepageController.index">PELAGIOS API</a>
          <ul>
            <li><a href="@controllers.pages.routes.HomepageController.index">Home</a></li>
            <li><a href="@controllers.pages.routes.DatasetPagesController.listAll">Datasets</a></li>
            <li><a href="#">Places</a></li>
          </ul>
        </div> <!-- .row -->
      </div> <!-- #header-menu -->
      
      <div id="header-body">
        <div class="row">
          @if(supersets.size > 0) {
          	<h2>
          	  @for(superset <- supersets) {
          	  	<a href="@controllers.pages.routes.DatasetPagesController.getDataset(superset.id)">@superset.title</a> &raquo;
          	  }
            </h2>
          }
          <h1>@dataset.title</h1>
          <h2>
            @if(dataset.homepage.isDefined) {
              by <a href="@dataset.homepage.get">@dataset.publisher</a>
            } else {
              by @dataset.publisher 
            }
          </h2>
          @dataset.description.map { description => <p class="description">@description</p> }
          <p class="time">
            @tags.timespan(dataset.temporalBoundsStart, dataset.temporalBoundsEnd)
          </p>
          <p class="stats">
            <span><em class="number">@things</em> items with</span>
            <span><em class="number">@annotations</em> references to</span>
            <span><em class="number">@places</em> unique places</span>
          </p>
        </div> <!-- .row -->
      </div> <!-- #header-body -->
    </div> <!-- #header -->
    
    <div id="content">
      <div class="row"><h2>Most Frequently Referenced Places</h2></div>
      <div class="row">
        <div class="float-right">
          <div id="map"></div>
          <div id="temporal-profile"></div>
        </div>
        
        <table id="top-n-places"></table>
      </div>
      
      @if(subsets.size > 0) {
      	<div class="row" id="subsets-list">
      	  <h2>Subsets</h2>
      	  <ul>
      	    @for(subset <- subsets) {
      	      <li><a href="@controllers.pages.routes.DatasetPagesController.getDataset(subset.id)">@subset.title</a></li>
      	    }
      	  </ul>
      	</div>
      }
    
      <div class="row" id="items-list">
        <h2>Items in this Dataset</h2>
        <div class="pagination"></div>
        <table class="styled">
          <thead>
            <tr>
              <th class="left">Title</th>
              <th class="center">Place References</th>
              <th class="center">Unique Places</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div> <!-- .row#items-list -->
    </div> <!-- #content -->
    
    <script>
      (function() {      
        var maxReferences,
            meterTemplate = 
              '<tr>' +
              '  <td class="place-title"><a href="@@href@@">@@title@@</a></td>' +
              '  <td class="place-count">' +
              '    <div class="meter">' +
              '      <div class="bar" style="width:@@width@@%;"></div><span>@@occurrences@@</span>' +
              '    </div>' +
              '  </td>'+ 
              '</tr>';
            
        // Helper function to show the next N places in the 'top places' list
        var showNext = function(places, shown, n) {
          for (var i=shown, j=shown + n; i<j; i++) {
            var occurrences = places[i].num_occurrences;
            console.log(places[i]);
            var html = meterTemplate
              .replace('@@href@@', '../places/' + encodeURIComponent(places[i].gazetteer_uri))
              .replace('@@title@@', places[i].title)
              .replace('@@width@@', (occurrences / maxReferences) * 100)
              .replace('@@occurrences@@', occurrences);
            $('#top-n-places').append(html);
          }
        };
      
        // Helper function to load a page of items
        var loadItems = function(offset, pagesize, callback) {
          $.getJSON('@routes.DatasetController.listAnnotatedThings(dataset.id)?offset=' + offset + '&limit=' + pagesize, function(data) {
            var table = $('#items-list table tbody');
            table.html('');
            $.each(data.items, function(idx, item) {
              var title = (item.homepage) ? '<a href="' + item.homepage + '" target="_blank">' + item.title + '</a>' : item.title;
              table.append('<tr>' + 
                             '<td>' + title + '</td>' +
                             '<td class="center">' + item.num_annotations + '</td>' +
                             '<td class="center">' + item.num_unique_places + '</td>' +
                           '</tr>');
            });
          
            if (callback)
              callback(data);
          });        
        };

        // Load items
        var pagesize = 20;
      
        loadItems(0, pagesize, function(data) {
          $('.pagination').pagination({
            items: data.total,
            itemsOnPage: pagesize,
            hrefTextPrefix: '#item-page-',
            onPageClick: function(pageNumber, event) {
              var offset = (pageNumber - 1) * pagesize;
              loadItems(offset, pagesize);
            }
          })
        });
      
        // Load places - limiting to the first 1 million places should be sufficient...
        $.getJSON('@routes.DatasetController.listPlaces(dataset.id, 1000000)&verbose=false', function(data) {
          maxReferences = data.items[0].num_occurrences;
        
          // List top 5 places
          showNext(data.items, 0, 10);
        
          // Draw heatmap
          var heatmap = new Heatmap('map', data.items);
        });
        
        // Load the temporal profile
        $.getJSON('@routes.DatasetController.getTemporalProfile(dataset.id)', function(data) {
          var histogram = new TemporalProfile('temporal-profile', data);
        });
      
        // Format numbers
        util.formatNumbers();
      })();
    </script>
  </body>
</html>
