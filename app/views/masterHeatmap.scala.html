@()
<html>
  <head>
    <title>Pelagios API - Map</title>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery-1.9.0.min.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/leaflet/leaflet.js")"></script>
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/leaflet/leaflet-heat.js")"></script>
    <link rel="stylesheet" href="@routes.Assets.at("javascripts/lib/leaflet/leaflet.css")"/>
    <style>
      html, body {
        width:100%,
        height:100%;
        padding:0;
        margin:0;
      }
      
      #map {
        width:100%;
        height:100%;
      }
    </style>
    <script>
      jQuery(document).ready(function() {
        // Quick hack        
        var awmcLayer = L.tileLayer('http://a.tiles.mapbox.com/v3/isawnyu.map-knmctlkh/{z}/{x}/{y}.png', {
          attribution: 'Tiles and Data &copy; 2013 <a href="http://www.awmc.unc.edu" target="_blank">AWMC</a> ' +
                       '<a href="http://creativecommons.org/licenses/by-nc/3.0/deed.en_US" target="_blank">CC-BY-NC 3.0</a>'});
    		  
        var map = new L.Map('map', {
          center: new L.LatLng(41.893588, 12.488022),
          zoom: 3,
          layers: [awmcLayer]
        });
        
        jQuery.getJSON('@controllers.pages.routes.MapController.masterHeatmap', function(data) {
          var latLons = [], minWeight = 9007199254740992, maxWeight = 0;
          
          jQuery.each(data, function(idx, pt) {
            if (pt.weight > maxWeight)
              maxWeight = pt.weight;
              
            latLons.push([pt.lat, pt.lon, pt.weight]);
          });
          
          L.heatLayer(latLons, { max: maxWeight/40, maxZoom: 6, radius: 8, blur: 8 }).addTo(map);
        });
      });
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
